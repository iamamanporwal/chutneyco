<!DOCTYPE html>
<html class="light" lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Your Cart - Chutney Co.</title>
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com" rel="preconnect"/>
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <!-- Theme Config -->
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#f2200d", // Chili Red
                        "primary-dark": "#c41607",
                        "secondary": "#225933", // Coriander Green
                        "accent": "#f5a623", // Mustard Yellow
                        "background-light": "#FAFAF8", // Garlic tint off-white
                        "background-dark": "#221110",
                        "card-light": "#ffffff",
                        "card-dark": "#2d1a19",
                    },
                    fontFamily: {
                        "display": ["Space Grotesk", "sans-serif"]
                    },
                    borderRadius: {
                        "DEFAULT": "0.5rem",
                        "lg": "1rem",
                        "xl": "1.5rem",
                        "2xl": "2rem",
                        "full": "9999px"
                    },
                    boxShadow: {
                        "soft": "0 10px 40px -10px rgba(0,0,0,0.08)",
                        "float": "0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)"
                    },
                    screens: {
                        '3xl': '1600px',
                    }
                },
            },
        }
    </script>
    <style>
        body {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        main {
            flex: 1;
        }
        /* Custom quantity input styling */
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
    </style>
</head>
<body class="bg-background-light dark:bg-background-dark font-display text-gray-900 dark:text-gray-100 antialiased selection:bg-primary/30">
    
    <!-- Scrolling Marquee -->
    <div class="bg-secondary text-white py-3 overflow-hidden whitespace-nowrap relative z-30">
        <div class="animate-marquee inline-block">
            <span class="mx-6 text-sm font-bold uppercase tracking-[0.2em]">FREE SHIPPING ON ORDERS OVER ₹999 • SPICE UP YOUR SLICE • 100% VEGAN •</span>
            <span class="mx-6 text-sm font-bold uppercase tracking-[0.2em]">FREE SHIPPING ON ORDERS OVER ₹999 • SPICE UP YOUR SLICE • 100% VEGAN •</span>
            <span class="mx-6 text-sm font-bold uppercase tracking-[0.2em]">FREE SHIPPING ON ORDERS OVER ₹999 • SPICE UP YOUR SLICE • 100% VEGAN •</span>
            <span class="mx-6 text-sm font-bold uppercase tracking-[0.2em]">FREE SHIPPING ON ORDERS OVER ₹999 • SPICE UP YOUR SLICE • 100% VEGAN •</span>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="sticky top-0 z-50 w-full backdrop-blur-md bg-background-light/80 dark:bg-background-dark/80 border-b border-gray-100 dark:border-gray-800 transition-all duration-300">
        <div class="flex items-center justify-between px-6 h-20 max-w-[1600px] mx-auto">
            <div class="flex items-center gap-12">
                <a class="text-2xl font-black tracking-tight text-gray-900 dark:text-white" href="index.html">
                    Chutney Co.
                </a>
                <div class="hidden md:flex items-center gap-8">
                    <a href="index.html" class="text-sm font-bold uppercase tracking-wide text-gray-500 dark:text-gray-400 hover:text-primary transition-colors">Home</a>
                    <a href="shop.html" class="text-sm font-bold uppercase tracking-wide text-gray-500 dark:text-gray-400 hover:text-primary transition-colors">Shop</a>
                    <a href="recipes.html" class="text-sm font-bold uppercase tracking-wide text-gray-500 dark:text-gray-400 hover:text-primary transition-colors">Recipes</a>
                    <a href="about.html" class="text-sm font-bold uppercase tracking-wide text-gray-500 dark:text-gray-400 hover:text-primary transition-colors">About</a>
                </div>
            </div>
            <div class="flex items-center gap-4">
                <button class="hidden md:flex text-sm font-bold uppercase tracking-wide text-gray-900 dark:text-white hover:text-primary transition-colors">Search</button>
                <div class="group relative">
                    <a href="cart.html" class="relative p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-900 dark:text-white transition-colors block">
                        <span class="material-symbols-outlined !text-[28px]">shopping_bag</span>
                        <span id="nav-cart-badge" class="absolute top-2 right-2 hidden h-2.5 w-2.5">
                            <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-primary opacity-75"></span>
                            <span class="relative inline-flex rounded-full h-2.5 w-2.5 bg-primary"></span>
                        </span>
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-[1600px] mx-auto px-6 py-12 w-full">
        <h1 class="text-5xl font-black text-gray-900 dark:text-white mb-12">Your Cart</h1>

        <div id="empty-cart-message" class="hidden flex-col items-center justify-center py-24 text-center">
            <span class="material-symbols-outlined text-6xl text-gray-300 mb-4">shopping_cart_off</span>
            <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">Your cart is empty</h2>
            <p class="text-gray-500 dark:text-gray-400 mb-8">Looks like you haven't added any spice yet.</p>
            <a href="shop.html" class="bg-primary hover:bg-primary-dark text-white font-bold text-lg py-4 px-8 rounded-xl transition-all hover:-translate-y-1">
                Start Shopping
            </a>
        </div>

        <div id="cart-content" class="grid lg:grid-cols-12 gap-12 hidden">
            <!-- Cart Items -->
            <div class="lg:col-span-8 space-y-6">
                <div class="bg-white dark:bg-card-dark rounded-3xl p-6 md:p-8 border border-gray-100 dark:border-gray-800 shadow-soft" id="cart-items-container">
                    <!-- Items will be injected here via JS -->
                </div>
                
                <div class="flex justify-between items-center pt-6">
                    <a href="shop.html" class="flex items-center gap-2 text-gray-500 hover:text-primary font-bold transition-colors">
                        <span class="material-symbols-outlined">arrow_back</span>
                        Continue Shopping
                    </a>
                </div>
            </div>

            <!-- Order Summary -->
            <div class="lg:col-span-4">
                <div class="sticky top-24 bg-white dark:bg-card-dark rounded-3xl p-6 md:p-8 border border-gray-100 dark:border-gray-800 shadow-soft">
                    <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6">Order Summary</h2>
                    
                    <div class="space-y-4 mb-8">
                        <div class="flex justify-between text-gray-600 dark:text-gray-400">
                            <span>Subtotal</span>
                            <span id="summary-subtotal" class="font-bold text-gray-900 dark:text-white">₹0.00</span>
                        </div>
                        <div class="flex justify-between text-gray-600 dark:text-gray-400">
                            <span>Shipping</span>
                            <span id="summary-shipping" class="font-bold text-gray-900 dark:text-white">Calculated at checkout</span>
                        </div>
                        <div class="border-t border-gray-100 dark:border-gray-800 my-4"></div>
                        <div class="flex justify-between text-xl font-bold text-gray-900 dark:text-white">
                            <span>Total</span>
                            <span id="summary-total">₹0.00</span>
                        </div>
                    </div>

                    <button id="checkout-btn" class="w-full bg-primary hover:bg-primary-dark text-white font-bold text-lg py-4 rounded-xl shadow-lg shadow-primary/30 transition-all hover:-translate-y-1 active:scale-95 flex items-center justify-center gap-2">
                        <span>Checkout</span>
                        <span class="material-symbols-outlined">lock</span>
                    </button>
                    
                    <p class="text-xs text-center text-gray-400 mt-4 flex items-center justify-center gap-1">
                        <span class="material-symbols-outlined text-sm">security</span>
                        Secure Encrypted Checkout
                    </p>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-50 dark:bg-card-dark pt-24 pb-12 px-6 mt-auto">
        <div class="max-w-[1600px] mx-auto">
            <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-12 mb-24">
                <div class="space-y-6">
                    <h2 class="text-3xl font-black text-gray-900 dark:text-white">Chutney Co.</h2>
                    <p class="text-gray-500 dark:text-gray-400 max-w-xs">
                        Making chutney cool again. Small batch, big flavor, zero compromise.
                    </p>
                </div>
                <div>
                    <h4 class="font-bold text-gray-900 dark:text-white mb-6 uppercase tracking-wider text-sm">Shop</h4>
                    <ul class="space-y-4 text-gray-600 dark:text-gray-400">
                        <li><a href="shop.html" class="hover:text-primary transition-colors">All Flavors</a></li>
                        <li><a href="shop.html" class="hover:text-primary transition-colors">Best Sellers</a></li>
                        <li><a href="shop.html" class="hover:text-primary transition-colors">Gift Sets</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-bold text-gray-900 dark:text-white mb-6 uppercase tracking-wider text-sm">Company</h4>
                    <ul class="space-y-4 text-gray-600 dark:text-gray-400">
                        <li><a href="about.html" class="hover:text-primary transition-colors">About Us</a></li>
                        <li><a href="recipes.html" class="hover:text-primary transition-colors">Recipes</a></li>
                        <li><a href="#" class="hover:text-primary transition-colors">Wholesale</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-bold text-gray-900 dark:text-white mb-6 uppercase tracking-wider text-sm">Stay Spicy</h4>
                    <p class="text-gray-500 dark:text-gray-400 mb-4 text-sm">Join the Sauce Squad for drops & deals.</p>
                    <form class="flex gap-2">
                        <input class="w-full rounded-xl border-gray-200 dark:border-gray-700 bg-white dark:bg-background-dark py-3 px-4 focus:ring-primary focus:border-primary" placeholder="Email address" type="email"/>
                        <button class="bg-gray-900 dark:bg-white text-white dark:text-gray-900 p-3 rounded-xl hover:opacity-90">
                            <span class="material-symbols-outlined">arrow_forward</span>
                        </button>
                    </form>
                </div>
            </div>
            <div class="border-t border-gray-200 dark:border-gray-800 pt-8 flex flex-col md:flex-row justify-between items-center gap-4 text-sm text-gray-400">
                <p>© 2023 Chutney Co. Crafted with spice.</p>
                <div class="flex gap-6">
                    <a class="hover:text-primary transition-colors" href="#">Instagram</a>
                    <a class="hover:text-primary transition-colors" href="#">TikTok</a>
                    <a class="hover:text-primary transition-colors" href="#">Twitter</a>
                </div>
            </div>
        </div>
    </footer>

    <style>
        @keyframes marquee {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }
        .animate-marquee {
            animation: marquee 20s linear infinite;
        }
    </style>

    <!-- Dependencies -->
    <script src="db.js"></script>
    <script src="auth.js"></script>

    <!-- Cart Logic -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const cartContent = document.getElementById('cart-content');
            const emptyCartMsg = document.getElementById('empty-cart-message');
            const cartItemsContainer = document.getElementById('cart-items-container');
            const summarySubtotal = document.getElementById('summary-subtotal');
            const summaryTotal = document.getElementById('summary-total');
            const navCartBadge = document.getElementById('nav-cart-badge');
            
            function renderCart() {
                const cart = db.getCart();
                const products = db.getProducts();
                
                // Update Nav Badge
                if (cart.length > 0) {
                    navCartBadge.classList.remove('hidden');
                } else {
                    navCartBadge.classList.add('hidden');
                }

                if (cart.length === 0) {
                    cartContent.classList.add('hidden');
                    cartContent.classList.remove('grid'); // Remove grid class to hide
                    emptyCartMsg.classList.remove('hidden');
                    emptyCartMsg.classList.add('flex');
                    return;
                }

                cartContent.classList.remove('hidden');
                cartContent.classList.add('grid');
                emptyCartMsg.classList.add('hidden');
                emptyCartMsg.classList.remove('flex');
                
                cartItemsContainer.innerHTML = '';
                let subtotal = 0;

                cart.forEach(item => {
                    const product = db.getProduct(item.productId);
                    if (!product) return;

                    const itemTotal = product.price * item.quantity;
                    subtotal += itemTotal;

                    const itemEl = document.createElement('div');
                    itemEl.className = 'flex flex-col md:flex-row gap-6 py-6 border-b border-gray-100 dark:border-gray-800 last:border-0';
                    itemEl.innerHTML = `
                        <div class="w-24 h-24 md:w-32 md:h-32 shrink-0 bg-gray-50 dark:bg-gray-900 rounded-xl bg-center bg-cover border border-gray-200 dark:border-gray-700" 
                             style="background-image: url('${product.image}')"></div>
                        
                        <div class="flex-1 flex flex-col justify-between">
                            <div class="flex justify-between items-start gap-4">
                                <div>
                                    <h3 class="text-xl font-bold text-gray-900 dark:text-white">${product.name}</h3>
                                    <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">${product.spiceLevel} • ${product.description}</p>
                                </div>
                                <span class="text-lg font-bold text-gray-900 dark:text-white">₹${product.price.toFixed(2)}</span>
                            </div>

                            <div class="flex justify-between items-end mt-4 md:mt-0">
                                <div class="flex items-center gap-3">
                                    <div class="flex items-center border border-gray-200 dark:border-gray-700 rounded-lg bg-white dark:bg-black/20">
                                        <button onclick="updateQuantity('${product.id}', -1)" class="p-2 text-gray-500 hover:text-primary transition-colors">
                                            <span class="material-symbols-outlined text-lg">remove</span>
                                        </button>
                                        <input type="number" value="${item.quantity}" readonly class="w-12 text-center bg-transparent border-0 p-0 text-gray-900 dark:text-white font-bold focus:ring-0 appearance-none"/>
                                        <button onclick="updateQuantity('${product.id}', 1)" class="p-2 text-gray-500 hover:text-primary transition-colors">
                                            <span class="material-symbols-outlined text-lg">add</span>
                                        </button>
                                    </div>
                                    <button onclick="removeItem('${product.id}')" class="text-sm text-gray-400 hover:text-red-500 underline underline-offset-4 decoration-dashed transition-colors">
                                        Remove
                                    </button>
                                </div>
                                <div class="text-right">
                                    <span class="text-sm text-gray-500 block">Total</span>
                                    <span class="font-bold text-gray-900 dark:text-white">₹${itemTotal.toFixed(2)}</span>
                                </div>
                            </div>
                        </div>
                    `;
                    cartItemsContainer.appendChild(itemEl);
                });

                // Update Summary
                const shippingThreshold = 999;
                const shippingCost = subtotal >= shippingThreshold ? 0 : 99;
                const total = subtotal + shippingCost;

                summarySubtotal.textContent = `₹${subtotal.toFixed(2)}`;
                
                const shippingEl = document.getElementById('summary-shipping');
                if (shippingCost === 0) {
                    shippingEl.textContent = 'Free';
                    shippingEl.classList.add('text-green-600');
                    shippingEl.classList.remove('text-gray-900', 'dark:text-white');
                } else {
                    shippingEl.textContent = `₹${shippingCost.toFixed(2)}`;
                    shippingEl.classList.remove('text-green-600');
                    shippingEl.classList.add('text-gray-900', 'dark:text-white');
                }

                summaryTotal.textContent = `₹${total.toFixed(2)}`;
            }

            // Expose functions to window for onclick handlers
            window.updateQuantity = (productId, change) => {
                const cart = db.getCart();
                const item = cart.find(i => i.productId === productId);
                if (item) {
                    const newQty = item.quantity + change;
                    if (newQty > 0) {
                        db.updateCartItem(productId, newQty);
                    }
                }
            };

            window.removeItem = (productId) => {
                db.removeFromCart(productId);
            };

            // Listen for cart updates
            window.addEventListener('cart-updated', renderCart);

            // Initial Render
            renderCart();

            // Checkout Button
            document.getElementById('checkout-btn').addEventListener('click', () => {
                const cart = db.getCart();
                if (cart.length === 0) return;
                window.location.href = 'checkout.html';
            });
        });
    </script>
</body>
</html>
